<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Velocity Drive: Neon Rush</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  background: radial-gradient(#0a0a14, #000);
  font-family: system-ui, Arial;
  color: white;
  overflow: hidden;
}

#ui {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 18px;
  background: rgba(0,0,0,.6);
  padding: 10px 18px;
  border-radius: 14px;
  backdrop-filter: blur(6px);
  z-index: 10;
}

#ui span {
  font-weight: 600;
}

#garage {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 420px;
  background: #05050a;
  border-top: 3px solid #00f6ff;
  padding: 12px;
  display: none;
  z-index: 10;
}

button {
  width: 100%;
  margin-top: 8px;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: linear-gradient(135deg, #00f6ff, #0066ff);
  color: black;
  font-weight: 800;
  cursor: pointer;
}
canvas {
  display: block;
  margin: auto;
}
</style>
</head>

<body>

<div id="ui">
  <span>üí∞ $<span id="money">0</span></span>
  <span>‚ö° <span id="speed">0</span></span>
  <span>üèÜ Best: <span id="best">0</span></span>
</div>

<canvas id="game" width="800" height="600"></canvas>

<div id="garage">
  <h3>üöó GARAGE</h3>
  <button onclick="upgrade('speed',500)">Upgrade Max Speed ($500)</button>
  <button onclick="upgrade('handling',400)">Upgrade Handling ($400)</button>
  <button onclick="upgrade('boost',600)">Upgrade Boost ($600)</button>
  <button onclick="toggleGarage()">Close</button>
</div>

<script>
/* ===== SAVE ===== */
let save = JSON.parse(localStorage.getItem("velocityDrive")) || {
  money: 0,
  best: 0,
  speed: 10,
  handling: 0.08,
  boost: 1.8
};

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== UI ===== */
const moneyEl = document.getElementById("money");
const speedEl = document.getElementById("speed");
const bestEl = document.getElementById("best");

/* ===== INPUT ===== */
const keys = {};
addEventListener("keydown", e => {
  keys[e.key.toLowerCase()] = true;
  if (e.key === "e") toggleGarage();
});
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* ===== PLAYER ===== */
let player = {
  x: 400,
  y: 460,
  vx: 0,
  speed: 0
};

/* ===== TRAFFIC ===== */
let cars = [];
function spawnCar() {
  cars.push({
    x: 200 + Math.random() * 400,
    y: -100,
    speed: 3 + Math.random() * 3
  });
}
setInterval(spawnCar, 900);

/* ===== GARAGE ===== */
function toggleGarage() {
  garage.style.display = garage.style.display ? "" : "block";
}
function upgrade(type, cost) {
  if (save.money < cost) return;
  save.money -= cost;
  if (type === "speed") save.speed += 1;
  if (type === "handling") save.handling += 0.01;
  if (type === "boost") save.boost += 0.2;
  localStorage.setItem("velocityDrive", JSON.stringify(save));
}

/* ===== GAME LOOP ===== */
function loop() {
  ctx.clearRect(0,0,800,600);

  // Road
  ctx.fillStyle = "#222";
  ctx.fillRect(150,0,500,600);
  ctx.strokeStyle = "#fff";
  ctx.setLineDash([20,20]);
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(400,0);
  ctx.lineTo(400,600);
  ctx.stroke();
  ctx.setLineDash([]);

  // Controls
  if (keys["w"] || keys["arrowup"]) player.speed += 0.2;
  if (keys["s"] || keys["arrowdown"]) player.speed -= 0.3;
  player.speed *= 0.98;
  player.speed = Math.max(0, Math.min(save.speed, player.speed));

  if (keys["a"] || keys["arrowleft"]) player.vx -= save.handling;
  if (keys["d"] || keys["arrowright"]) player.vx += save.handling;
  player.vx *= 0.9;

  player.x += player.vx * 60;
  player.x = Math.max(170, Math.min(630, player.x));

  // Player car
  ctx.fillStyle = "#00f6ff";
  ctx.shadowColor = "#00f6ff";
  ctx.shadowBlur = 20;
  ctx.fillRect(player.x-18, player.y-40, 36, 70);
  ctx.shadowBlur = 0;

  // Traffic
  cars.forEach(c => {
    c.y += c.speed + player.speed;
    ctx.fillStyle = "#ff3355";
    ctx.fillRect(c.x-18, c.y-40, 36, 70);

    if (Math.abs(c.x-player.x)<30 && Math.abs(c.y-player.y)<50) crash();
  });

  cars = cars.filter(c => c.y < 700);

  // Score & money
  save.money += player.speed * 0.1;
  save.best = Math.max(save.best, save.money);

  moneyEl.textContent = Math.floor(save.money);
  speedEl.textContent = player.speed.toFixed(1);
  bestEl.textContent = Math.floor(save.best);

  localStorage.setItem("velocityDrive", JSON.stringify(save));

  requestAnimationFrame(loop);
}
loop();

function crash() {
  alert("CRASH! Distance Saved.");
  location.reload();
}
</script>

</body>
</html>
