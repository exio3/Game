<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Velocity Drive: Synthwave</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  background:#000;
  font-family:system-ui,Arial;
  overflow:hidden;
  color:white;
}
canvas{display:block;margin:auto}

/* Screens */
.screen{
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:10;
}
#menu{
  display:flex;
  background:#0f0f14; /* lighter black */
}
#crash{
  background:#000;
}

h1{
  font-size:48px;
  margin:0;
  text-shadow:0 0 25px #ff00ff;
}
p{opacity:.85}

button{
  margin-top:12px;
  padding:12px 26px;
  font-size:16px;
  font-weight:800;
  border:none;
  border-radius:12px;
  background:linear-gradient(135deg,#ff00ff,#00f6ff);
  color:black;
  cursor:pointer;
  box-shadow:0 0 20px #ff00ff;
}
</style>
</head>

<body>

<!-- MENU -->
<div id="menu" class="screen">
  <h1>VELOCITY DRIVE</h1>
  <p>S Y N T H W A V E</p>
  <button onclick="startGame()">START</button>
</div>

<!-- CRASH -->
<div id="crash" class="screen">
  <h1>CRASHED</h1>
  <p>Distance: <span id="finalDist">0</span> ft</p>
  <button onclick="restart()">Restart</button>
  <button onclick="toMenu()">Main Menu</button>
</div>

<canvas id="game" width="800" height="600"></canvas>

<script>
/* ================== SETUP ================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let state="menu";

/* SAVE */
let save = JSON.parse(localStorage.getItem("vd_synth")) || {
  best:0,
  unlocked:1
};

/* INPUT */
const keys={};
addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

/* GAMEPAD */
function gamepad(){
  const g=navigator.getGamepads()[0];
  if(!g) return;
  if(g.axes[0]<-0.2) keys["a"]=true;
  if(g.axes[0]>0.2) keys["d"]=true;
  if(g.buttons[0].pressed) keys["w"]=true;
}

/* AUDIO */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
const engine=audioCtx.createOscillator();
const gain=audioCtx.createGain();
engine.type="sawtooth";
engine.connect(gain).connect(audioCtx.destination);
engine.start();
gain.gain.value=0;

/* PLAYER */
let player, speed, dist;
const cars=[
  {color:"#00f6ff",max:12},
  {color:"#ff00ff",max:14},
  {color:"#ffe600",max:16}
];

/* TRAFFIC */
let traffic=[];

/* START */
function startGame(){
  menu.style.display="none";
  crash.style.display="none";
  state="game";
  player={x:400,vx:0,car:0};
  speed=0;
  dist=0;
  traffic=[];
  audioCtx.resume();
}

/* RESTART */
function restart(){startGame()}
function toMenu(){
  state="menu";
  menu.style.display="flex";
  crash.style.display="none";
}

/* SPAWN TRAFFIC */
setInterval(()=>{
  if(state!=="game")return;
  traffic.push({x:200+Math.random()*400,y:-80});
},900);

/* DRAW BACKGROUND */
function background(){
  // sky
  const g=ctx.createLinearGradient(0,0,0,600);
  g.addColorStop(0,"#2b0055");
  g.addColorStop(1,"#000");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,800,600);

  // sun
  ctx.beginPath();
  ctx.arc(400,200,90,0,Math.PI*2);
  ctx.fillStyle="#ff2fd2";
  ctx.shadowColor="#ff2fd2";
  ctx.shadowBlur=30;
  ctx.fill();
  ctx.shadowBlur=0;

  // grid
  ctx.strokeStyle="#7f00ff";
  for(let i=0;i<20;i++){
    ctx.beginPath();
    ctx.moveTo(0,400+i*20);
    ctx.lineTo(800,400+i*20);
    ctx.stroke();
  }
}

/* LOOP */
function loop(){
  requestAnimationFrame(loop);
  if(state!=="game") return;

  gamepad();
  background();

  // controls
  if(keys["w"]||keys["arrowup"]) speed+=0.2;
  if(keys["s"]||keys["arrowdown"]) speed-=0.25;
  speed*=0.98;
  speed=Math.max(0,Math.min(cars[player.car].max,speed));

  if(keys["a"]||keys["arrowleft"]) player.vx-=0.15;
  if(keys["d"]||keys["arrowright"]) player.vx+=0.15;
  player.vx*=0.9;
  player.x+=player.vx*18;
  player.x=Math.max(200,Math.min(600,player.x));

  // engine sound
  engine.frequency.value=80+speed*20;
  gain.gain.value=0.03+speed*0.01;

  // car
  ctx.fillStyle=cars[player.car].color;
  ctx.shadowColor=cars[player.car].color;
  ctx.shadowBlur=25;
  ctx.fillRect(player.x-20,460,40,80);
  ctx.shadowBlur=0;

  // traffic
  traffic.forEach(t=>{
    t.y+=speed+4;
    ctx.fillStyle="#ff004c";
    ctx.fillRect(t.x-18,t.y,36,80);
    if(Math.abs(t.x-player.x)<30 && Math.abs(t.y-460)<60) crashGame();
  });
  traffic=traffic.filter(t=>t.y<700);

  // distance
  dist+=speed;
  save.best=Math.max(save.best,dist);
  ctx.fillStyle="white";
  ctx.fillText(`Distance: ${Math.floor(dist)} ft`,20,30);
  ctx.fillText(`Best: ${Math.floor(save.best)} ft`,20,50);

  // unlock cars
  if(dist>1500) save.unlocked=2;
  if(dist>3000) save.unlocked=3;

  localStorage.setItem("vd_synth",JSON.stringify(save));
}
loop();

/* CRASH */
function crashGame(){
  state="crash";
  finalDist.textContent=Math.floor(dist);
  crash.style.display="flex";
  gain.gain.value=0;
}
</script>

</body>
</html>
